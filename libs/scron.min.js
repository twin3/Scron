export default class Scron{constructor(t){this.MONTHS=[["January","Jan"],["February","Feb"],["March","Mar"],["April","Apr"],["May","May"],["June","Jun"],["July","Jul"],["August","Aug"],["September","Sep"],["October","Oct"],["November","Nov"],["December","Dec"]],this.DAYS=[["Sunday","Sun"],["Monday","Mon"],["Tuesday","Tue"],["Wednesday","Wed"],["Thursday","Thu"],["Friday","Fri"],["Saturday","Sat"]],this.KEY={ms:"MS",s:"SE",m:"MI",h:"HO",dom:"DM",mo:"MO",dow:"DW",st:"ST",en:"ET",mr:"MR"};let e=t||"";this.DAYS.map(t=>{e=e.replace(new RegExp("("+t.join("|")+")","gi"),"")}),this.MONTHS.map(t=>{e=e.replace(new RegExp(t.join("|"),"gi"),"")}),null!==(e=e.replace(/\d|\*|,|-| |L/g,"")).match(new RegExp(/\w|:/,"gi"))?this.updateFromDescription(t||""):this.updateFromFormula(t||"")}dateStringToDate(t){try{if(t&&8===t.length){const e=Number(t.substring(0,2)),s=Number(t.substring(2,4))-1,a=Number(t.substring(4));return new Date(Date.UTC(a,s,e,0,0,0,0))}return null}catch(t){return console.log(t),null}}getIntRange(t){let e=[],s=0,a=0,i=t.split("-");if(2===i.length&&!isNaN(i[0])&&!isNaN(i[1])){s=Number(i[0]),a=Number(i[1]);for(let t=Math.min(s,a);t<=Math.max(s,a);t++)e.push(t)}return e}concatenateStringList(t,e){let s="";for(let a=0;a<t.length;a++)0===a?s+=t[a]:a===t.length-1?s+=` ${e||"and"} ${t[a]}`:s+=`, ${t[a]}`;return s}nth(t){if(t>3&&t<21)return"th";switch(t%10){case 1:return"st";case 2:return"nd";case 3:return"rd";default:return"th"}}nthAllIntsInString(t){let e="",s="";for(let a=0;a<t.length;a++){const i=t.charAt(a),h=t.charAt(a+1);-1!=="0123456789".indexOf(i)&&(s+=i),e+=i,s.length>0&&(!h||-1==="0123456789".indexOf(h))&&(e+=this.nth(Number(s)),s="")}return e}numberWithCommas(t){return t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}intArrayToRangeStrings(t,e){let s=[],a=[],i=null;t=t.sort((t,e)=>t-e);for(let h=0;h<t.length;h++){a.push(t[h]);let l=t[h+1]?t[h+1]-t[h]:-1;if(-1===l||i&&l!==i){if(a.length>3)i>1?s.push(`every ${i} ${e?e+" ":""}between and including the ${a[0]} and ${a[a.length-1]}`):s.push(`the ${a[0]} -> ${a[a.length-1]}${h<t.length-1&&e?" "+e:""}`);else for(let t=0;t<a.length;t++)s.push(`${a[t]}`);a=[]}i=l}return s}getRange(t,e){let s=[];try{if(t)for(let a=0;a<t.split(",").length;a++){const i=t.split(",")[a];let h=[];if(i&&"*"!==i&&"L"!==i)if(i.indexOf("-")>-1)h=this.getIntRange(i);else if(new RegExp("^[*]?/([1-9][0-9]{0,2})$").test(i)){let t=i.indexOf("*/")>-1?Number(i.substring(2)):Number(i.substring(1)),s=0,a=0;for(let t=0;t<e.length;t++)e[t]>s&&(s=e[t]);for(;a<=s;)(a+=t)<=s&&h.push(a)}else i.endsWith("L")?h.push(Number(i.slice(0,-1))):h.push(Number(i));else h=e||[];for(let t=0;t<h.length;t++)-1===s.indexOf(h[t])&&s.push(h[t])}else s=e||[]}catch(t){}return s}static toDateFormat(t,e){const s=new Scron,a=new Date(t),i={dddd:s.DAYS[a.getUTCDay()][0],ddd:s.DAYS[a.getUTCDay()][0].substring(0,3),dd:("0"+a.getDate()).slice(-2),d:a.getDate().toString(),MMMM:s.MONTHS[a.getMonth()][0],MMM:s.MONTHS[a.getMonth()][0].substring(0,3),MM:("0"+(a.getMonth()+1)).slice(-2),M:(a.getMonth()+1).toString(),yyyy:a.getFullYear().toString(),yyy:a.getFullYear().toString().startsWith("0")||3===a.getFullYear().toString().length?a.getFullYear().toString().slice(-3):a.getFullYear().toString(),yy:a.getFullYear().toString().slice(-2),y:a.getFullYear().toString().slice(-2).startsWith("0")?a.getFullYear().toString().slice(-1):a.getFullYear().toString().slice(-2),HH:("0"+a.getHours()).slice(-2),H:a.getHours().toString(),hh:("0"+(a.getHours()%12==0?12:a.getHours()%12)).slice(-2),h:a.getHours()%12==0?12:a.getHours()%12,mm:("0"+a.getMinutes().toString()).slice(-2),m:a.getMinutes().toString(),ss:("0"+a.getSeconds().toString()).slice(-2),s:a.getSeconds().toString(),fff:("000"+a.getMilliseconds()).slice(-3),ff:a.getMilliseconds()>99?a.getMilliseconds().toString():("000"+a.getMilliseconds()).slice(-2),f:a.getMilliseconds()};let h="",l=[];for(let t=0;t<e.length;t++){const s=e.charAt(t);h+=s,(e.charAt(t+1)!==s||h.length>=4)&&(l.push(h),h="")}let r=!1;for(let t=l.length;t>=0;t--){const e=l[t];"^"===e?(r=!0,l.splice(t,1)):i.hasOwnProperty(e)&&(l[t]=i[e],r&&(l[t]=s.nthAllIntsInString(l[t]),r=!1))}return l.join("")}setupDefaultParams(){this.params={},this.params[this.KEY.ms]={index:0,original:"",default:[],value:[],strRange:"0-999",type:"range"},this.params[this.KEY.s]={index:1,original:"",default:[],value:[],strRange:"0-59",type:"range"},this.params[this.KEY.m]={index:2,original:"",default:[],value:[],strRange:"0-59",type:"range"},this.params[this.KEY.h]={index:3,original:"",default:[],value:[],strRange:"0-23",type:"range"},this.params[this.KEY.dom]={index:4,original:"",default:[],value:[],strRange:"1-31",type:"range"},this.params[this.KEY.mo]={index:5,original:"",default:[],value:[],strRange:"1-12",type:"range"},this.params[this.KEY.dow]={index:6,original:"",default:[],value:[],strRange:"0-6",type:"range"},this.params[this.KEY.st]={index:7,original:"",default:null,value:null,type:"date"},this.params[this.KEY.en]={index:8,original:"",default:null,value:null,type:"date"},this.params[this.KEY.mr]={index:8,original:"",default:null,value:null,type:"int"};for(let t in this.params)"range"===this.params[t].type&&(this.params[t].default=this.getIntRange(this.params[t].strRange))}updateFromDescription(t){this.formatString=t;let e=t;this.setupDefaultParams(),e=e.replace(/  /," ");const s="and|&|nd|then",a="reach(es|s|'s)?|achieve(s|'s)?|land(s)?[ ](on|at|around)",i="january|jan|february|feb|march|mar|april|apr|may|june|jun|july|jul|august|aug|september|sept|sep|october|oct|november|nov|december|dec",h=[{reg:"((run(s)?)?[ ]?([1-9][0-9]{0,5}|1000000)[ ]((time|run)(s)?))",paramsKey:this.KEY.mr,get:t=>[t.replace(/[^\d]/gi,"")]},{reg:`(((from|start|begin[n]?)(s|ing)?([ ](on|from))?([ ]((d{1,2}(th|st|rd|nd)?[ ]?(of)?[ ]?)?((d{1,2})|${i})[ ]?(d{1,2}(th|st|rd|nd)?[ ]?(of)?[ ]?)?[ ]?(d{1,4})?))))`,paramsKey:this.KEY.st,get:t=>{t.split(" ").map(t=>new Date).filter(t=>{})}},{reg:"(every|all|each|\\*)[ ]?(ms|mil(li[ ]?second(')?(s)?)?)",paramsKey:this.KEY.ms,get:t=>"*"},{reg:`(((\\d{1,3})(th|st|rd|nd)?[ ]?)|(((\\d{1,3})(th|st|rd|nd)?[,]?[ ]((${s})[ ])?)+[ ]?((\\d{1,3})(th|st|rd|nd)?[ ]?)))(ms|mil(li[ ]?second(')?(s)?)?)`,paramsKey:this.KEY.ms,get:t=>t.replace(/[^\d\s]/gi,"").split(" ").map(t=>t.trim()).filter(t=>!!t&&""!==t)},{reg:`(ms|mil(li[ ]?second(')?(s)?)?)[ ](${a})?[ ]?(((\\d{1,3}(th|st|rd|nd)?[,]?[ ]((${s})[ ])?)+[ ]?(\\d{1,3}(th|st|rd|nd)?))|(\\d{1,3}(th|st|rd|nd)?))`,paramsKey:this.KEY.ms,get:t=>t.replace(/[^\d\s]/gi,"").split(" ").map(t=>t.trim()).filter(t=>!!t&&""!==t)},{reg:"\\d{2}:\\d{2}:\\d{2}[:|.]\\d{1,3}",paramsKey:this.KEY.ms,get:t=>[t.replace(/[^\d\s\:\.]/gi,"").replace(/\./gi,":").split(":")[3]]},{reg:"(every|all|each|\\*)[ ]?(sec(ond)?(')?s?)",paramsKey:this.KEY.s,get:t=>"*"},{reg:`((([1-5][0-9]|[0-9])(th|st|rd|nd)?[ ]?)|((([1-5][0-9]|[0-9])(th|st|rd|nd)?[,]?[ ]((${s})[ ])?)+[ ]?(([1-5][0-9]|[0-9])(th|st|rd|nd)?[ ]?)))(sec(ond)?(')?s?)`,paramsKey:this.KEY.s,get:t=>t.replace(/[^\d\s]/gi,"").split(" ").map(t=>t.trim()).filter(t=>!!t&&""!==t)},{reg:`([^i]sec(ond)?(')?s?)[ ](${a})?[ ]?(((([1-5][0-9]|[0-9])(th|st|rd|nd)?[,]?[ ](${s})?)+[ ]?(([1-5][0-9]|[0-9])(th|st|rd|nd)?))|(([1-5][0-9]|[0-9])(th|st|rd|nd)?))`,paramsKey:this.KEY.s,get:t=>t.replace(/[^\d\s]/gi,"").split(" ").map(t=>t.trim()).filter(t=>!!t&&""!==t)},{reg:"\\d{2}:\\d{2}:\\d{2}([:|.]\\d{1,3})?",paramsKey:this.KEY.s,get:t=>[t.replace(/[^\d\s\:\.]/gi,"").replace(/\./gi,":").split(":")[2]]},{reg:"(every|all|each|\\*)[ ]?(min(ute)?s?)",paramsKey:this.KEY.m,get:t=>"*"},{reg:`((([1-5][0-9]|[0-9])(th|st|rd|nd)?[ ]?)|((([1-5][0-9]|[0-9])(th|st|rd|nd)?[,]?[ ]((${s})[ ])?)+[ ]?(([1-5][0-9]|[0-9])(th|st|rd|nd)?[ ]?)))(min(ute)?(')?s?)`,paramsKey:this.KEY.m,get:t=>t.replace(/[^\d\s]/gi,"").split(" ").map(t=>t.trim()).filter(t=>!!t&&""!==t)},{reg:`(min(ute)?(')?s?)[ ](${a})?[ ]?(((([1-5][0-9]|[0-9])(th|st|rd|nd)?[,]?[ ](${s})?)+[ ]?(([1-5][0-9]|[0-9])(th|st|rd|nd)?))|(([1-5][0-9]|[0-9])(th|st|rd|nd)?))`,paramsKey:this.KEY.m,get:t=>t.replace(/[^\d\s]/gi,"").split(" ").map(t=>t.trim()).filter(t=>!!t&&""!==t)},{reg:"\\d{2}:\\d{2}(:\\d{2}([:|.]\\d{1,3})?)?",paramsKey:this.KEY.m,get:t=>[t.replace(/[^\d\s\:\.]/gi,"").replace(/\./gi,":").split(":")[1]]},{reg:"(every|all|each|\\*)[ ]?(hour(')?(s)?)",paramsKey:this.KEY.h,get:t=>"*"},{reg:`(((2[0-3]|1[0-9]|[0-9])(th|st|rd|nd)?[ ]?)|(((2[0-3]|1[0-9]|[0-9])(th|st|rd|nd)?[,]?[ ]((${s})[ ])?)+[ ]?((2[0-3]|1[0-9]|[0-9])(th|st|rd|nd)?[ ]?)))(hour(')?(s)?)`,paramsKey:this.KEY.h,get:t=>t.replace(/[^\d\s]/gi,"").split(" ").map(t=>t.trim()).filter(t=>!!t&&""!==t)},{reg:`(hour(')?(s)?)[ ](${a})?[ ]?((((2[0-3]|1[0-9]|[0-9])(th|st|rd|nd)?[,]?[ ](${s})?)+[ ]?((2[0-3]|1[0-9]|[0-9])(th|st|rd|nd)?))|((2[0-3]|1[0-9]|[0-9])(th|st|rd|nd)?))`,paramsKey:this.KEY.h,get:t=>t.replace(/[^\d\s]/gi,"").split(" ").map(t=>t.trim()).filter(t=>!!t&&""!==t)},{reg:"[ ]((2[0-3]|[0-1][0-9]|[0-9])[ ]?(am|pm))",paramsKey:this.KEY.h,get:t=>{const e=Number(t.replace(/[^\d]/gi,""));return t.toLowerCase().indexOf("am")>-1?[e]:[12===e?0:e<12?e+12:e]}},{reg:"\\d{2}:\\d{2}(:\\d{2}([:|.]\\d{1,3})?)?",paramsKey:this.KEY.h,get:t=>[t.replace(/[^\d\s\:\.]/gi,"").replace(/\./gi,":").split(":")[0]]},{reg:"(every|all|each|\\*)[ ]((month[ ](day|date)?(')?(s)?)|(day|date)(')?(s)?[ ](of|in)[ ](the|a)?[ ]month)",paramsKey:this.KEY.dom,get:t=>"*"},{reg:`(((3[0-1]|[1-2][0-9]|[0-9])(th|st|rd|nd)?[,]?[ ]((${s})[ ])?)+(of[ ])?(the[ ])?(date|month|${i}))|(((date|day|${i})(')?(s)?)[ ]((3[0-1]|[1-2][0-9]|[0-9])(th|st|rd|nd)?[,]?[ ]?((${s})[ ])?)+)`,paramsKey:this.KEY.dom,get:t=>t.replace(/[^\d\s]/gi,"").split(" ").map(t=>t.trim()).filter(t=>!!t&&""!==t)},{reg:"(every|all|each|\\*)[ ]month(')?(s)?",paramsKey:this.KEY.mo,get:t=>"*"},{reg:`\\b(${i})\\b`,paramsKey:this.KEY.mo,get:t=>{for(let e=0;e<this.MONTHS.length;e++)for(let s=0;s<this.MONTHS[e].length;s++)if(t.toLowerCase()===this.MONTHS[e][s].toLowerCase())return[e+1];return[]}},{reg:"(every|all|each|\\*)[ ]?week[ ]?day(')?(s)?",paramsKey:this.KEY.dow,get:t=>"*"},{reg:"\\b(sunday|sun|monday|mon|tuesday|tue|wednesday|wed|thursday|thur|friday|fri|saturday|sat)\\b",paramsKey:this.KEY.dow,get:t=>{for(let e=0;e<this.DAYS.length;e++)for(let s=0;s<this.DAYS[e].length;s++)if(t.toLowerCase()===this.DAYS[e][s].toLowerCase())return[e];return console.log("Day Nope"),[]}}];for(let t=0;t<h.length;t++){const s=h[t],a=new RegExp(s.reg,"gi"),i=e.match(a);let l=[];if(null!==i&&i.length>0)for(let t=0;t<i.length;t++){switch(this.params[s.paramsKey].type){case"range":if("*"===(l=s.get(i[t])))this.params[s.paramsKey].value=this.getRange("*",this.params[s.paramsKey].default);else for(let t=0;t<l.length;t++)this.params[s.paramsKey].value.push(l[t]);break;case"date":break;case"int":l=s.get(i[t]),this.params[s.paramsKey].value=Number(l[0])}e=e.replace(a,"")}if(e.trim().length<=0)break}if(this.params[this.KEY.ms].value.length>0?(this.params[this.KEY.s].value=this.params[this.KEY.s].value.length>0?this.params[this.KEY.s].value:this.params[this.KEY.s].default,this.params[this.KEY.m].value=this.params[this.KEY.m].value.length>0?this.params[this.KEY.m].value:this.params[this.KEY.m].default,this.params[this.KEY.h].value=this.params[this.KEY.h].value.length>0?this.params[this.KEY.h].value:this.params[this.KEY.h].default,this.params[this.KEY.dom].value=this.params[this.KEY.dom].value.length>0?this.params[this.KEY.dom].value:this.params[this.KEY.dom].default,this.params[this.KEY.mo].value=this.params[this.KEY.mo].value.length>0?this.params[this.KEY.mo].value:this.params[this.KEY.mo].default,this.params[this.KEY.dow].value=this.params[this.KEY.dow].value.length>0?this.params[this.KEY.dow].value:this.params[this.KEY.dow].default):this.params[this.KEY.s].value.length>0?(this.params[this.KEY.ms].value=this.params[this.KEY.ms].value.length>0?this.params[this.KEY.ms].value:[0],this.params[this.KEY.m].value=this.params[this.KEY.m].value.length>0?this.params[this.KEY.m].value:this.params[this.KEY.m].default,this.params[this.KEY.h].value=this.params[this.KEY.h].value.length>0?this.params[this.KEY.h].value:this.params[this.KEY.h].default,this.params[this.KEY.dom].value=this.params[this.KEY.dom].value.length>0?this.params[this.KEY.dom].value:this.params[this.KEY.dom].default,this.params[this.KEY.mo].value=this.params[this.KEY.mo].value.length>0?this.params[this.KEY.mo].value:this.params[this.KEY.mo].default,this.params[this.KEY.dow].value=this.params[this.KEY.dow].value.length>0?this.params[this.KEY.dow].value:this.params[this.KEY.dow].default):this.params[this.KEY.m].value.length>0?(this.params[this.KEY.ms].value=this.params[this.KEY.ms].value.length>0?this.params[this.KEY.ms].value:[0],this.params[this.KEY.s].value=this.params[this.KEY.s].value.length>0?this.params[this.KEY.s].value:[0],this.params[this.KEY.h].value=this.params[this.KEY.h].value.length>0?this.params[this.KEY.h].value:this.params[this.KEY.h].default,this.params[this.KEY.dom].value=this.params[this.KEY.dom].value.length>0?this.params[this.KEY.dom].value:this.params[this.KEY.dom].default,this.params[this.KEY.mo].value=this.params[this.KEY.mo].value.length>0?this.params[this.KEY.mo].value:this.params[this.KEY.mo].default,this.params[this.KEY.dow].value=this.params[this.KEY.dow].value.length>0?this.params[this.KEY.dow].value:this.params[this.KEY.dow].default):this.params[this.KEY.h].value.length>0?(this.params[this.KEY.ms].value=this.params[this.KEY.ms].value.length>0?this.params[this.KEY.ms].value:[0],this.params[this.KEY.s].value=this.params[this.KEY.s].value.length>0?this.params[this.KEY.s].value:[0],this.params[this.KEY.m].value=this.params[this.KEY.m].value.length>0?this.params[this.KEY.m].value:[0],this.params[this.KEY.dom].value=this.params[this.KEY.dom].value.length>0?this.params[this.KEY.dom].value:this.params[this.KEY.dom].default,this.params[this.KEY.mo].value=this.params[this.KEY.mo].value.length>0?this.params[this.KEY.mo].value:this.params[this.KEY.mo].default,this.params[this.KEY.dow].value=this.params[this.KEY.dow].value.length>0?this.params[this.KEY.dow].value:this.params[this.KEY.dow].default):this.params[this.KEY.dom].value.length>0?(this.params[this.KEY.ms].value=this.params[this.KEY.ms].value.length>0?this.params[this.KEY.ms].value:[0],this.params[this.KEY.s].value=this.params[this.KEY.s].value.length>0?this.params[this.KEY.s].value:[0],this.params[this.KEY.m].value=this.params[this.KEY.m].value.length>0?this.params[this.KEY.m].value:[0],this.params[this.KEY.h].value=this.params[this.KEY.h].value.length>0?this.params[this.KEY.h].value:[0],this.params[this.KEY.mo].value=this.params[this.KEY.mo].value.length>0?this.params[this.KEY.mo].value:this.params[this.KEY.mo].default,this.params[this.KEY.dow].value=this.params[this.KEY.dow].value.length>0?this.params[this.KEY.dow].value:this.params[this.KEY.dow].default):this.params[this.KEY.mo].value.length>0?(this.params[this.KEY.ms].value=this.params[this.KEY.ms].value.length>0?this.params[this.KEY.ms].value:[0],this.params[this.KEY.s].value=this.params[this.KEY.s].value.length>0?this.params[this.KEY.s].value:[0],this.params[this.KEY.m].value=this.params[this.KEY.m].value.length>0?this.params[this.KEY.m].value:[0],this.params[this.KEY.h].value=this.params[this.KEY.h].value.length>0?this.params[this.KEY.h].value:[0],this.params[this.KEY.dom].value=this.params[this.KEY.dom].value.length>0?this.params[this.KEY.dom].value:[1],this.params[this.KEY.dow].value=this.params[this.KEY.dow].value.length>0?this.params[this.KEY.dow].value:this.params[this.KEY.dow].default):this.params[this.KEY.dow].value.length>0&&(this.params[this.KEY.ms].value=this.params[this.KEY.ms].value.length>0?this.params[this.KEY.ms].value:[0],this.params[this.KEY.s].value=this.params[this.KEY.s].value.length>0?this.params[this.KEY.s].value:[0],this.params[this.KEY.m].value=this.params[this.KEY.m].value.length>0?this.params[this.KEY.m].value:[0],this.params[this.KEY.h].value=this.params[this.KEY.h].value.length>0?this.params[this.KEY.h].value:[0],this.params[this.KEY.dom].value=this.params[this.KEY.dom].value.length>0?this.params[this.KEY.dom].value:[1],this.params[this.KEY.mo].value=this.params[this.KEY.mo].value.length>0?this.params[this.KEY.mo].value:this.params[this.KEY.mo].default),null!==this.params[this.KEY.mr].value&&null===this.params[this.KEY.st].value){const t=new Date;this.params[this.KEY.st].original=`${("00"+t.getDate().toString()).slice(-2)}${("00"+(t.getMonth()+1).toString()).slice(-2)}${t.getFullYear()}`,this.params[this.KEY.st].value=t}this.validateResult=this.validateFormula()}updateFromFormula(t){this.formatString=t,this.setupDefaultParams();for(let e=0;e<this.MONTHS.length;e++)for(let s=0;s<this.MONTHS[e].length;s++)t=t.replace(new RegExp(`${this.MONTHS[e][s]}`,"gi"),e);for(let e=0;e<this.DAYS.length;e++)for(let s=0;s<this.DAYS[e].length;s++)t=t.replace(new RegExp(`${this.DAYS[e][s]}`,"gi"),e);this.formatSplit=t.split(" ");for(let t in this.params)switch(this.params[t].original=this.formatSplit[this.params[t].index]||null,this.params[t].type){case"range":this.params[t].value=this.getRange(this.formatSplit[this.params[t].index],this.params[t].default);break;case"date":this.params[t].value=this.dateStringToDate(this.formatSplit[this.params[t].index]);break;case"int":this.params[t].value=isNaN(this.formatSplit[this.params[t].index])?null:Number(this.formatSplit[this.params[t].index])}this.validateResult=this.validateFormula()}toString(){let t="",e=!1,s="";if(!0!==this.validateResult)t=this.validateResult;else if(""===this.formatString.trim())t="No Scron entered";else{const a=this.params[this.KEY.ms],i=this.params[this.KEY.s],h=this.params[this.KEY.m],l=this.params[this.KEY.h],r=this.params[this.KEY.dom],n=this.params[this.KEY.mo],u=this.params[this.KEY.dow],m=this.params[this.KEY.st],g=this.params[this.KEY.en],o=this.params[this.KEY.mr];if(t+=s=m.value?`Runs from ${Scron.toDateFormat(m.value,"dddd d^ MMMM yyyy")}`:"Runs",a.value.length===a.default.length&&i.value.length===i.default.length&&h.value.length===h.default.length&&l.value.length===l.default.length&&r.value.length===r.default.length&&n.value.length===n.default.length&&u.value.length===u.default.length)t+=" every millisecond";else if(1===a.value.length&&i.value.length===i.default.length&&h.value.length===h.default.length&&l.value.length===l.default.length&&r.value.length===r.default.length&&n.value.length===n.default.length&&u.value.length===u.default.length)0===a.value[0]?t+=" once every second, precisely on the second":t+=` once every second at the ${a.value[0]}${this.nth(a.value[0])} millisecond`;else{if(n.value.length===n.default.length)t+="";else if(t+=" ",1===n.value.length)t+=`every ${this.MONTHS[n.value[0]-1][0]}`;else{let e=n.value.map((t,e,s)=>this.MONTHS[t-1][0]);t+=`every ${this.concatenateStringList(e)}`}if(u.value.length!==u.default.length)if(t+=" ",1===u.value.length)u.original.indexOf("L")>-1?t+=`on the last ${this.DAYS[u.value[0]][0]} of the month`:n.value.length===n.default.length?t+=`every ${this.DAYS[u.value[0]][0]}`:t+=`on ${this.DAYS[u.value[0]][0]}s`;else{let e=u.value.map((t,e,s)=>this.DAYS[t][0]);t+=`weekdays ${this.concatenateStringList(e)}`}if("L"===r.original)t+=" on the last day of the month";else if(r.value.length!==r.default.length)if(1===r.value.length)t+=` on the ${r.value[0]}${this.nth(r.value[0])} of the month`;else{const e=this.nthAllIntsInString(this.concatenateStringList(this.intArrayToRangeStrings(r.value,"date"),"and"));t+=` on ${e.startsWith("the")||e.startsWith("every")?"":"the "}${e} of the month`}if(1===l.value.length&&0===l.value[0]&&1===h.value.length&&0===h.value[0]&&1===i.value.length&&0===i.value[0]&&1===a.value.length&&0===a.value[0])t+=" at midnight";else{if(l.value.length===l.default.length)h.value.length===h.default.length?t+="":t+=t===s?" each hour":", on each hour";else if(1===l.value.length&&0===l.value[0])t+=t===s?" ":", ",t+="at midnight";else{const e=this.nthAllIntsInString(this.concatenateStringList(this.intArrayToRangeStrings(l.value,"hour")));t+=t===s?" ":", ",t+=`on ${e.startsWith("the")||e.startsWith("every")?"":"the "}${e} hour`}if(t+=t===s?" ":", ",h.value.length===h.default.length)t+="every minute";else if(1===h.value.length&&0===h.value[0]&&1===i.value.length&&0===i.value[0]&&1===a.value.length&&0===a.value[0])e=!0,t+="precisely on the hour";else if(1===h.value.length&&0===h.value[0])t+="on the hour";else{const e=this.nthAllIntsInString(this.concatenateStringList(this.intArrayToRangeStrings(h.value,"minute")));t+=`on ${e.startsWith("the")||e.startsWith("every")?"":"the "}${e} minute`}if(!e){if(i.value.length===i.default.length)t+=", every second";else if(1===i.value.length&&0===i.value[0])h.value.length===h.default.length?t+=", precisely on the minute":t+="";else{const e=this.nthAllIntsInString(this.concatenateStringList(this.intArrayToRangeStrings(i.value,"second")));t+=`, on ${e.startsWith("the")||e.startsWith("every")?"":"the "}${e} second`}e||(a.value.length===a.default.length?(t+=" and every millisecond",1===i.value.length&&(t+=" within that second")):1===a.value.length&&0===a.value[0]?t+="":1===a.value.length?t+=` and on the ${a.value[0]}${this.nth(a.value[0])} millisecond`:t+=` and on ${this.nthAllIntsInString(this.concatenateStringList(this.intArrayToRangeStrings(a.value,"millisecond")))} millisecond`)}}}o.value&&o.value?t+=`, for ${this.numberWithCommas(o.value)} run${o.value>1?"s.":"."}`:g.value&&g.value?t+=`, until ${g.value.getUTCDate()}${this.nth(g.value.getUTCDate())} of ${this.MONTHS[g.value.getUTCMonth()][0]} ${g.value.getUTCFullYear()}.`:t+=", until the end of time."}return t}isValid(){return!0===this.validateResult}validateFormula(){let t=[],e="[0-9]{1,3}";const s=`([*]|((${e}|${e}-${e}|[*]?/([12458]|10|2[05]|40|50|100|125|200|250|500))((,(${e}|${e}-${e}|[*]?/[1-9]{1,3}))*)))`,a=`([*]|((${e="([0-9]|[0-5][0-9])"}|${e}-${e}|[*]?/([123456]|1[025]|20|30))((,(${e}|${e}-${e}|[*]?/([123456]|1[025]|20|30)))*)))`,i=`([*]|((${e}|${e}-${e}|[*]?/([123456]|1[025]|20|30))((,(${e}|${e}-${e}|[*]?/([123456]|1[025]|20|30)))*)))`,h=`([*]|((${e="([0-9]|1[0-9]|2[0-3])"}|${e}-${e}|[*]?/([123468]|12))((,(${e}|${e}-${e}|[*]?/([123468]|12)))*)))`,l=`([*]|((([1-9]|[12][0-9]|30|31|L)|${e="([1-9]|[12][0-9]|30|31)"}-${e}|[*]?/1)((,(([1-9]|[12][0-9]|30|31|L)|${e}-${e}|[*]?/1))*)))`,r="([*]|(0[1-9]|[12][0-9]|30|31)(0[1-9]|1[0-2])(2[0-5][0-9][0-9]))",n=`([*]|(((${e="([0-6]|sun(day)?|mon(day)?|tue(sday)?|wed(nesday)?|thu(rsday)?|fri(day)?|sat(urday)?)"}L?)|${e}-${e}|[*]?/[123])((,(${e}|${e}-${e}|[*]?/[123]))*)))`,u=`([*]|((${e="(([1-9]|1[0-2])|jan|january|feb|february|mar|march|apr|april|may|jun|june|jul|july|aug|august|sep|september|oct|october|nov|november|dec|december)"}|${e}-${e}|[*]?/([12346]|12))((,(${e}|${e}-${e}|[*]?/([12346]|12)))*)))`,m=new RegExp(`^(${s}|(${s}[ ]${a})|(${s}[ ]${a}[ ]${i})|(${s}[ ]${a}[ ]${i}[ ]${h})|(${s}[ ]${a}[ ]${i}[ ]${h}[ ]${l})|(${s}[ ]${a}[ ]${i}[ ]${h}[ ]${l}[ ]${u})|(${s}[ ]${a}[ ]${i}[ ]${h}[ ]${l}[ ]${u}[ ]${n})|(${s}[ ]${a}[ ]${i}[ ]${h}[ ]${l}[ ]${u}[ ]${n}[ ]${r})|(${s}[ ]${a}[ ]${i}[ ]${h}[ ]${l}[ ]${u}[ ]${n}[ ]${r}[ ]([*]|([1-9][0-9]{0,5}|1000000)|(0[1-9]|[12][0-9]|30|31)(0[1-9]|1[0-2])(2[0-5][0-9][0-9]))))$`,"i").test(this.formatString),g=this.params[this.KEY.ms],o=this.params[this.KEY.s],p=this.params[this.KEY.m],d=this.params[this.KEY.h],v=this.params[this.KEY.dom],K=this.params[this.KEY.mo],Y=this.params[this.KEY.dow],E=this.params[this.KEY.st],f=this.params[this.KEY.en],c=this.params[this.KEY.mr];if(!1===m){const e=new RegExp(`^${s}$`),m=new RegExp(`^${a}$`),$=new RegExp(`^${i}$`),y=new RegExp(`^${h}$`),S=new RegExp(`^${l}$`),w=new RegExp(`^${u}$`),T=new RegExp(`^${n}$`),M=new RegExp(`^${r}$`),D=new RegExp("^([*]|(0[1-9]|[12][0-9]|30|31)(0[1-9]|1[0-2])(2[0-5][0-9][0-9]))$"),N=new RegExp("^([1-9][0-9]{0,5}|1000000)$");g.original&&!e.test(g.original)&&t.push("Milliseconds[1]"),o.original&&!m.test(o.original)&&t.push("Seconds[2]"),p.original&&!$.test(p.original)&&t.push("Minutes[3]"),d.original&&!y.test(d.original)&&t.push("Hours[4]"),v.original&&!S.test(v.original)&&t.push("Day of Month[5]"),K.original&&!w.test(K.original)&&t.push("Month[6]"),Y.original&&!T.test(Y.original)&&t.push("Day of Week[7]"),E.original&&!M.test(E.original)&&t.push("Start Date[8]"),(f.original&&!D.test(f.original)||c.value&&!N.test(c.value)||c.value&&(!E.original||"*"===E.original))&&t.push("End Date[9]")}else!c.value||E.original&&"*"!==E.original||t.push("End Date[9]");return!(t.length>0)||`Invalid ${this.concatenateStringList(t)}.`}nextRun(t){try{const e=this.params[this.KEY.ms].value,s=this.params[this.KEY.s].value,a=this.params[this.KEY.m].value,i=this.params[this.KEY.h].value,h=this.params[this.KEY.dom].value,l=this.params[this.KEY.mo].value,r=this.params[this.KEY.dow].value,n=this.params[this.KEY.st].value,u=this.params[this.KEY.en].value,m=this.params[this.KEY.mr].value;let g=0;const o=t?new Date(new Date(t).getTime()+1):n||new Date,p=m?new Date:new Date(o),d={NOT:1,CONTINUE:2,RUNNABLE:3},v=t=>{if(m){return t<o?d.NOT:t>=p?d.RUNNABLE:d.CONTINUE}return t>=p&&(!o||t>=o)&&(!u||t<=u)?d.RUNNABLE:d.NOT};let K,Y=null;t:for(let t=o.getUTCFullYear();t<(u?u.getUTCFullYear():o.getUTCFullYear()+10);t++)if((K=new Date(o)).setUTCFullYear(t),v(K)!==d.NOT)for(let n=0;n<l.length;n++){(K=new Date(o)).setUTCDate(1),K.setUTCMonth(l[n]-1),K.setUTCFullYear(t);for(let u=0;u<h.length;u++){const o=new Date(t,l[n],0).getUTCDate();if(this.params[this.KEY.dom].original&&this.params[this.KEY.dom].original.indexOf("L")>-1){if(o!==h[u])continue;K.setUTCDate(h[u])}else K.setUTCDate(h[u]);if(v(K)!==d.NOT&&r.indexOf(K.getUTCDay())>-1&&(!this.params[this.KEY.dow].original||!this.params[this.KEY.dow].original.endsWith("L")||h[u]>o-7))for(let t=0;t<i.length;t++)if(K.setUTCHours(i[t]),v(K)!==d.NOT)for(let t=0;t<a.length;t++)if(K.setUTCMinutes(a[t]),v(K)!==d.NOT)for(let t=0;t<s.length;t++)if(K.setUTCSeconds(s[t]),v(K)!==d.NOT)for(let t=0;t<e.length;t++)switch(K.setUTCMilliseconds(e[t]),v(K)){case d.RUNNABLE:Y=K;break t;case d.CONTINUE:if((g+=1)>=m)break t}}}return Y||null}catch(t){return console.log(t),null}}};